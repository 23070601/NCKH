# Vietnamese FDI Stock Data Documentation

## Overview

This directory contains processed time-series data for **98 Vietnamese Foreign Direct Investment (FDI)** companies, prepared for volatility prediction and multi-algorithm comparison research.

**Date Range**: 2022-01-01 to 2024-12-31 (773 trading days)  
**Data Source**: Synthetic sample data (realistic simulation); switch to `vnstock` for real market data  
**Structure**: Follows [SP100AnalysisWithGNNs](https://github.com/timothewt/SP100AnalysisWithGNNs) reference format

---

## Directory Structure

```
data/
├── raw/                        # Input data
│   └── fdi_stocks_list.csv    # Stock metadata (ticker, name, sector, exchange)
├── processed/                  # Main outputs
│   ├── values.csv             # Time-series with engineered features
│   └── adj.npy                # Stock correlation adjacency matrix
├── features/                   # Feature matrices (generated by notebooks)
│   ├── close_matrix.csv       # Stock × Date close prices
│   ├── dailylogreturn_matrix.csv
│   ├── rsi_matrix.csv
│   ├── macd_matrix.csv
│   └── tickers.csv            # List of 98 stock tickers
└── analysis/                   # Visualizations and reports
    ├── feature_distributions.png
    ├── adjacency_matrix.png
    └── timeseries_topstocks.png
```

---

## Data Files

### 1. `processed/values.csv`

**Description**: Multi-indexed time-series DataFrame with engineered features for all stocks.

**Format**:
- **Index**: Multi-level (Symbol, Date)
- **Rows**: 75,754 (98 stocks × 773 dates)
- **Columns**: 9 features

**Features**:

| Feature | Description | Formula/Method |
|---------|-------------|----------------|
| `Close` | Daily closing price | Raw price data |
| `NormClose` | Z-score normalized close | $(Close - \mu) / \sigma$ |
| `DailyLogReturn` | Daily log return | $\log(P_t / P_{t-1})$ |
| `ALR1W` | Annualized log return (1 week) | $\log(P_t / P_{t-5}) \times (252/5)$ |
| `ALR2W` | Annualized log return (2 weeks) | $\log(P_t / P_{t-10}) \times (252/10)$ |
| `ALR1M` | Annualized log return (1 month) | $\log(P_t / P_{t-21}) \times (252/21)$ |
| `ALR2M` | Annualized log return (2 months) | $\log(P_t / P_{t-42}) \times (252/42)$ |
| `RSI` | Relative Strength Index (14-period) | $100 - 100/(1 + RS)$ |
| `MACD` | Moving Average Convergence Divergence | $EMA_{12} - EMA_{26}$ |

**Statistics**:

```
Feature          Mean      Std       Min       Max
Close          116.23    89.45     17.89    588.53
DailyLogReturn  -0.0000   0.0202   -0.1932   0.1820
RSI             50.12    28.64      0.00     99.80
MACD             0.034    2.891   -21.718   28.656
```

**Usage**:
```python
import pandas as pd
values = pd.read_csv('data/processed/values.csv', index_col=[0, 1])

# Access specific stock
vnm_data = values.loc['VNM']

# Access all stocks on a date
date_data = values.xs('2024-01-15', level='Date')

# Get feature for all stocks
returns = values['DailyLogReturn'].unstack(level='Symbol')
```

---

### 2. `processed/adj.npy`

**Description**: Symmetric adjacency matrix representing stock correlations for graph-based models.

**Format**:
- **Type**: NumPy binary array
- **Shape**: (98, 98)
- **Edges**: 36 non-zero connections
- **Density**: 0.0037 (0.37% of possible edges)

**Construction**:
1. Calculate correlation matrix from `DailyLogReturn` across all stocks
2. Apply threshold (correlation > 0.1) to create binary adjacency
3. Result: 1 if stocks are correlated above threshold, 0 otherwise

**Properties**:
- Symmetric: `adj[i,j] == adj[j,i]`
- No self-loops: `adj[i,i] == 0`
- Sparse: Most stock pairs show weak correlation in sample data

**Usage**:
```python
import numpy as np
adj = np.load('data/processed/adj.npy')

# Find neighbors of stock index 0
neighbors = np.where(adj[0] > 0)[0]

# Calculate node degrees
degrees = adj.sum(axis=1)
```

**Note**: With real market data, edge count will increase significantly (threshold=0.3 recommended for real data).

---

### 3. `raw/fdi_stocks_list.csv`

**Description**: Metadata for 98 Vietnamese FDI companies.

**Columns**:
- `ticker`: Stock symbol (e.g., VNM, SAB)
- `name`: Full company name
- `sector`: Industry sector (Financials, Consumer Staples, etc.)
- `exchange`: Trading exchange (HOSE, HNX)
- `fdi_status`: FDI penetration level (High, Medium, Low)
- `market_cap`: Market capitalization category (Large, Medium, Small)

**Sector Distribution**:
```
Financials              28
Consumer Staples         8
Real Estate             12
Energy                   6
Materials                5
...
```

---

## Feature Engineering Details

### Normalization
- **Close prices**: Z-score per stock (mean=0, std=1)
- **Returns**: Raw log returns (no normalization)
- **RSI/MACD**: Indicator-specific ranges

### Handling Missing Data
- **Forward fill**: Propagate last valid observation
- **Backward fill**: Fill initial NaNs from first valid date
- **Result**: Zero missing values in final dataset

### Correlation Calculation
- **Method**: Pearson correlation on `DailyLogReturn`
- **Window**: Full time series (773 days)
- **Threshold**: 0.1 for sample data (increase to 0.3 for real data)

---

## Data Quality Report

```
[STRUCTURE]
  Total records: 75,754
  Features: 9
  Unique stocks: 98
  Trading days: 773

[DATA INTEGRITY]
  Missing values: 0
  ✓ Complete dataset, no NaN values

[DATE RANGE]
  Start: 2022-01-03
  End: 2024-12-31
  Duration: 1093 days

[ADJACENCY MATRIX]
  Non-zero edges: 36
  Density: 0.0037
  Symmetric: True
```

---

## Usage Examples

### Load Full Dataset
```python
import pandas as pd
import numpy as np

# Load time-series
values = pd.read_csv('data/processed/values.csv', index_col=[0, 1])

# Load graph structure
adj = np.load('data/processed/adj.npy')

print(f"Data shape: {values.shape}")
print(f"Stocks: {values.index.get_level_values('Symbol').nunique()}")
```

### Analyze Specific Stock
```python
# Get VNM (Vietnam Dairy) data
vnm = values.loc['VNM']

# Plot closing price
import matplotlib.pyplot as plt
plt.plot(vnm.index, vnm['Close'])
plt.title('VNM Closing Price')
plt.show()

# Calculate volatility
volatility = vnm['DailyLogReturn'].std()
print(f"VNM volatility: {volatility:.4f}")
```

### Cross-Stock Analysis
```python
# Create returns matrix (stocks × dates)
returns_matrix = values['DailyLogReturn'].unstack(level='Symbol')

# Calculate correlation
corr = returns_matrix.corr()

# Find most correlated pairs
import numpy as np
corr_pairs = []
for i in range(len(corr)):
    for j in range(i+1, len(corr)):
        corr_pairs.append((corr.index[i], corr.columns[j], corr.iloc[i,j]))

top_pairs = sorted(corr_pairs, key=lambda x: abs(x[2]), reverse=True)[:10]
print("Top 10 correlated pairs:")
for s1, s2, c in top_pairs:
    print(f"  {s1} - {s2}: {c:.4f}")
```

---

## Regenerating Data

To regenerate with different parameters:

```python
from src.VNStocks import VNStocksDataset

dataset = VNStocksDataset(
    stock_list_path='data/raw/fdi_stocks_list.csv',
    start_date='2022-01-01',
    end_date='2024-12-31',
    raw_dir='data/raw',
    processed_dir='data/processed'
)

# Collect data (use 'vnstock' for real data)
dataset.collect_price_data(source='manual')

# Process and save
dataset.process_and_save()
```

To adjust correlation threshold, modify `src/VNStocks.py` line 80:
```python
self._create_adjacency_matrix(correlation_threshold=0.3)  # Adjust threshold
```

---

## Notes

### Sample Data vs Real Data
- **Current**: Synthetic data generated with geometric Brownian motion
- **Real Data**: Install `vnstock` and change `source='manual'` → `source='vnstock'`
- **Correlation**: Sample data shows weaker correlations; real market data will have stronger sector/industry correlations

### Performance
- Data generation: ~30 seconds (98 stocks)
- Feature engineering: ~5 seconds
- Total dataset size: ~6 MB

### Citation
If using this data structure in research, please cite:
- Reference structure: [SP100AnalysisWithGNNs](https://github.com/timothewt/SP100AnalysisWithGNNs)
- Vietnamese stock data: [vnstock](https://github.com/thinh-vu/vnstock)

---

## Version History

- **v1.0** (2025-01-19): Initial dataset with 98 FDI stocks, 9 features, correlation threshold=0.1
